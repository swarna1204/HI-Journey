<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Hyper Island Journey ‚Äî VR Proxy Example</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/aframe-super-hands-component@6.0.4/dist/aframe-super-hands.min.js"></script>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        #storyOverlay {
            display: none;
            position: fixed;
            left: 50%;
            top: 110px;
            transform: translateX(-50%);
            background: rgba(34, 40, 49, 0.95);
            color: #fff;
            font-size: 1.5rem;
            max-width: 80vw;
            padding: 1.3rem 2.3rem;
            border-radius: 18px;
            box-shadow: 0 4px 32px #111a;
            z-index: 99999 !important;
            text-align: center;
        }

        #backButton {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000;
            display: none;
        }

        .aframe-hovered {
            outline: 3px solid #21c06b !important;
            filter: brightness(1.2) drop-shadow(0 0 15px #21c06bAA);
        }
    </style>
</head>

<body>
    <div id="storyOverlay"></div>
    <div id="backButton">Back</div>
    <a-scene xr-mode-ui="enabled: true" renderer="antialias: true; precision: high;">
        <a-sky color="#222831"></a-sky>
        <a-entity light="type: ambient; intensity: 1"></a-entity>
        <a-entity light="type: directional; intensity: 0.8" position="5 10 5"></a-entity>
        <a-assets>
            <a-asset-item id="roomModel" src="model/model.glb"></a-asset-item>
        </a-assets>
        <!-- Main room model (position/scale as before) -->
        <a-entity id="model" gltf-model="#roomModel" position="-5 -10 -5" scale="10 10 10"></a-entity>
        <!-- Proxy for Monitor (adjust position/size to match your GLB monitor object!) -->
        <a-entity id="monitor-proxy" geometry="primitive: box; width: 1.2; height: 0.7; depth: 0.2"
            position="1.3 1.3 -1.6" material="color: #fff; opacity: 0; transparent: true"
            class="intersectable"></a-entity>
        <!-- Proxy for Bed (adjust position/size to match your GLB bed object!) -->
        <a-entity id="bed-proxy" geometry="primitive: box; width: 2.5; height: 0.6; depth: 1.2" position="0.1 0.8 -3"
            material="color: #fff; opacity: 0; transparent: true" class="intersectable"></a-entity>
        <!-- Camera Rig & VR Controllers -->
        <a-entity id="cameraRig" position="0 4 10">
            <a-camera look-controls wasd-controls></a-camera>
            <a-entity laser-controls="hand: right" super-hands sphere-collider="objects: .intersectable"></a-entity>
            <a-entity laser-controls="hand: left" super-hands sphere-collider="objects: .intersectable"></a-entity>
        </a-entity>
        <!-- Desktop mouse support -->
        <a-entity cursor="rayOrigin: mouse" raycaster="objects: .intersectable"></a-entity>
    </a-scene>
    <script>
        const cameraEl = document.querySelector('#cameraRig');
        const storyOverlay = document.getElementById('storyOverlay');
        const backButton = document.getElementById('backButton');
        // Store last camera position/quaternion to go "back"
        const defaultCameraPos = new THREE.Vector3(0, 4, 10);
        const defaultCameraQuat = new THREE.Quaternion().setFromEuler(new THREE.Euler(0, 0, 0));
        // Target positions for zoom (tweak for your scene)
        const meshTargets = {
            'monitor': { pos: new THREE.Vector3(1.3, 1.3, -1.6), story: "üíª <b>The Monitor</b><br>Countless late nights learning, coding, and applying for jobs. Every click was a step forward." },
            'bed': { pos: new THREE.Vector3(0.1, 0.8, -3), story: "üõèÔ∏è <b>The Bed</b><br>Balancing motherhood and ambition‚Äîmy journey was about family as much as career." }
        };
        function showStory(text) {
            storyOverlay.innerHTML = text;
            storyOverlay.style.display = "block";
        }
        function hideStory() {
            storyOverlay.style.display = "none";
        }
        function focusOnObject(target) {
            const cam3D = cameraEl.object3D;
            const obj = meshTargets[target];
            if (!obj) return;
            const center = obj.pos;
            const newCameraPos = center.clone().add(new THREE.Vector3(0, 1.5, 2.5)); // Camera offset (edit for your model)
            new TWEEN.Tween(cam3D.position)
                .to({ x: newCameraPos.x, y: newCameraPos.y, z: newCameraPos.z }, 1200)
                .easing(TWEEN.Easing.Quadratic.Out)
                .start();
            const temp = { t: 0 };
            const startQuat = cam3D.quaternion.clone();
            const endQuat = new THREE.Quaternion().setFromRotationMatrix(
                new THREE.Matrix4().lookAt(newCameraPos, center, new THREE.Vector3(0, 1, 0))
            );
            new TWEEN.Tween(temp)
                .to({ t: 1 }, 1200)
                .easing(TWEEN.Easing.Quadratic.Out)
                .onUpdate(() => {
                    cam3D.quaternion.copy(startQuat).slerp(endQuat, temp.t);
                })
                .start();
            backButton.style.display = "block";
        }
        // Click & grab handler for monitor
        ['monitor-proxy', 'bed-proxy'].forEach(proxyId => {
            const proxyEl = document.getElementById(proxyId);
            const key = proxyId.replace('-proxy', '');
            // For VR controllers (grab-start)
            proxyEl.addEventListener('grab-start', () => {
                focusOnObject(key);
                showStory(meshTargets[key].story);
            });
            // For mouse click
            proxyEl.addEventListener('click', () => {
                focusOnObject(key);
                showStory(meshTargets[key].story);
            });
            // Hover effect (optional)
            proxyEl.addEventListener('hover-start', () => proxyEl.classList.add('aframe-hovered'));
            proxyEl.addEventListener('hover-end', () => proxyEl.classList.remove('aframe-hovered'));
        });
        // Back button resets camera/story
        backButton.addEventListener('click', () => {
            const cam3D = cameraEl.object3D;
            new TWEEN.Tween(cam3D.position)
                .to({ x: defaultCameraPos.x, y: defaultCameraPos.y, z: defaultCameraPos.z }, 1200)
                .easing(TWEEN.Easing.Quadratic.Out)
                .start();
            const temp = { t: 0 };
            const startQuat = cam3D.quaternion.clone();
            const endQuat = defaultCameraQuat.clone();
            new TWEEN.Tween(temp)
                .to({ t: 1 }, 1200)
                .easing(TWEEN.Easing.Quadratic.Out)
                .onUpdate(() => {
                    cam3D.quaternion.copy(startQuat).slerp(endQuat, temp.t);
                })
                .start();
            backButton.style.display = "none";
            hideStory();
        });
        function animate() { requestAnimationFrame(animate); TWEEN.update(); }
        animate();
        // Optional: show intro story
        setTimeout(() => {
            showStory("üå± <b>A New City, A New Start</b><br><span style='font-size:1rem;opacity:0.82'>My Hyper Island journey began here, where everything felt new and full of hope.</span>");
        }, 600);
    </script>
</body>

</html>