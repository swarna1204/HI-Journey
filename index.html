<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>VR Webhook Logging Test</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
</head>

<body>
    <a-scene background="color: #111" xr-mode-ui="enabled: true">
        <!-- Test Box -->
        <a-box id="target-box" class="clickable" position="0 1.5 -3" color="red"></a-box>

        <!-- Camera + Controllers -->
        <a-entity position="0 1.6 0">
            <a-camera>
                <a-cursor fuse="false" raycaster="objects: .clickable" material="color: yellow"
                    geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02" position="0 0 -1"></a-cursor>
            </a-camera>

            <a-entity id="rightHand" oculus-touch-controls="hand: right" raycaster="objects: .clickable; showLine: true"
                line="color: #FF4081" webhook-logger>
            </a-entity>

            <a-entity id="leftHand" oculus-touch-controls="hand: left" raycaster="objects: .clickable; showLine: true"
                line="color: #00BCD4" webhook-logger>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        AFRAME.registerComponent('webhook-logger', {
            init: function () {
                const el = this.el;
                const webhookUrl = 'https://webhook.site/7e711964-46a9-4f17-82a1-06ffce9a8b0f'; // replace below

                function sendLog(message) {
                    fetch(webhookUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ log: message, source: el.id || 'unknown' })
                    }).catch(() => { });
                }

                el.addEventListener('buttondown', () => {
                    const hit = el.components.raycaster.intersectedEl;
                    if (hit) {
                        sendLog(`✅ HIT: ${hit.id || hit.tagName || hit.className}`);
                    } else {
                        sendLog(`❌ Button pressed, but no intersectedEl`);
                    }
                });

                el.addEventListener('raycaster-intersection', (e) => {
                    const seen = e.detail.els.map(el => el.id || el.tagName || '[unknown]');
                    sendLog(`🎯 Raycaster seeing: ${seen.join(', ')}`);
                });

                el.addEventListener('raycaster-intersection-cleared', () => {
                    sendLog(`⚪ Raycaster cleared from: ${el.id}`);
                });
            }
        });
    </script>
</body>

</html>