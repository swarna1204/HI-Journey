<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Hyper Island Journey ‚Äî Debuggable Interaction</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: Arial;
        }

        #story-header {
            /* ‚Ä¶ your existing styles ‚Ä¶ */
        }

        /* ‚Ä¶ rest of your CSS ‚Ä¶ */
        #overlay em {
            color: #ff0;
            font-size: 0.8em;
        }
    </style>
</head>

<body>
    <!-- desktop header / overlay / controls-info same as before -->
    <div id="story-header">
        <h1 id="story-title">A New City‚Ä¶</h1>
        <p id="story-subtitle">‚Ä¶hope</p>
    </div>
    <div id="overlay">
        <div id="overlay-text"></div><button onclick="closeOverlay()">Close</button>
    </div>
    <div id="controls-info">Mouse: Look around | WASD: Move | Click: Interact</div>

    <a-scene background="color: #1a1a2e" vr-mode-ui="enabled: true">
        <a-assets><a-asset-item id="roomModel" src="model/model.glb"></a-asset-item></a-assets>
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="5 5 5"></a-light>

        <!-- your GLB -->
        <a-entity id="model" gltf-model="#roomModel" position="-5 -10 -5" scale="10 10 10"></a-entity>

        <!-- camera + cursors -->
        <a-entity camera look-controls wasd-controls position="0 2 5">
            <a-cursor fuse="false" rayOrigin="mouse" geometry="primitive:ring;radiusInner:0.02;radiusOuter:0.03"
                material="color:white" raycaster="objects:.clickable"></a-cursor>
        </a-entity>
        <a-entity hand-controls="hand:left" laser-controls raycaster="objects:.clickable"></a-entity>
        <a-entity hand-controls="hand:right" laser-controls raycaster="objects:.clickable"></a-entity>

        <!-- VR headers/text same as before -->
        <!-- ‚Ä¶ -->
    </a-scene>

    <script>
        let isVR = false, vrTextTimeout;

        function getStory(meshName) {
            const l = meshName.toLowerCase();
            if (l.includes('bed') || l.includes('blanket') || l.includes('pillow')) return { title: 'The Bed', info: 'Balancing‚Ä¶' };
            if (l.includes('monitor')) return { title: 'The Monitor', info: 'Countless late nights‚Ä¶' };
            if (l.includes('plant')) return { title: 'The Plant', info: 'Roots take time‚Ä¶' };
            if (l.includes('rack')) return { title: 'YouTube Frame', info: 'YouTube was my‚Ä¶' };
            if (l.includes('cylinder')) return { title: 'The Wall Frame', info: 'My wall frames‚Ä¶' };
            if (l.includes('speaker')) return { title: 'The Speaker', info: 'Podcasts and music‚Ä¶' };
            if (l.includes('cube011') || l.includes('cube') || l.includes('light'))
                return { title: 'The Light', info: 'The light shines‚Ä¶' };
            return { title: 'Discovery', info: 'This object is part‚Ä¶' };
        }

        function handleClick(el) {
            const meshName = el.getAttribute('data-mesh-name');
            console.log('üîç clicked meshName:', meshName);
            const { title, info } = getStory(meshName);
            const finalInfo = title === 'Discovery'
                ? `${info}<br><br><em>(meshName: ${meshName})</em>`
                : info;
            updateStoryHeader(title, finalInfo);
            isVR ? showVRText(title, finalInfo) : showOverlay(title, finalInfo);
            el.setAttribute('animation__click', 'property:scale;to:0.8 0.8 0.8;dur:200');
            setTimeout(() => el.setAttribute('animation__click', 'property:scale;to:1 1 1;dur:200'), 200);
        }

        // ‚Ä¶ insert here your updateStoryHeader(), showOverlay(), closeOverlay(), showVRText(), etc ‚Ä¶

        document.addEventListener('DOMContentLoaded', () => {
            const modelEl = document.getElementById('model');
            modelEl.addEventListener('model-loaded', () => {
                const mesh = modelEl.getObject3D('mesh');
                mesh.updateMatrixWorld(true);
                mesh.traverse(node => {
                    if (node.isMesh && node.name) {
                        console.log('üè∑Ô∏è found mesh node:', node.name);
                        const box = new THREE.Box3().setFromObject(node);
                        const size = box.getSize(new THREE.Vector3());
                        const center = box.getCenter(new THREE.Vector3());
                        const proxy = document.createElement('a-box');
                        proxy.setAttribute('width', size.x);
                        proxy.setAttribute('height', size.y);
                        proxy.setAttribute('depth', size.z);
                        proxy.setAttribute('position', `${center.x} ${center.y} ${center.z}`);
                        proxy.setAttribute('material', 'opacity:0;transparent:true');
                        proxy.setAttribute('class', 'clickable');
                        proxy.setAttribute('data-mesh-name', node.name);
                        proxy.addEventListener('click', () => handleClick(proxy));
                        document.querySelector('a-scene').appendChild(proxy);
                    }
                });
            });
        });
    </script>
</body>

</html>