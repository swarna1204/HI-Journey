<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>VR Controller Laser + Click Test</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
</head>

<body>
    <a-scene background="color: #111" xr-mode-ui="enabled: true">

        <!-- Ground -->
        <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#444"></a-plane>

        <!-- Red Test Box -->
        <a-box position="0 1.5 -3" color="red" class="clickable" id="target-box"></a-box>

        <!-- Lighting -->
        <a-entity light="type: directional; intensity: 1" position="1 2 1"></a-entity>
        <a-entity light="type: ambient; intensity: 0.6"></a-entity>

        <!-- Camera + Hand Controllers -->
        <a-entity id="rig" position="0 1.6 0">
            <a-camera>
                <a-cursor fuse="false" raycaster="objects: .clickable" material="color: yellow"
                    geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02" position="0 0 -1">
                </a-cursor>
            </a-camera>

            <!-- Right Hand -->
            <a-entity id="rightHand" meta-touch-controls="hand: right" raycaster="objects: .clickable; showLine: true"
                line="color: #FF4081" vr-button-click-logger>
            </a-entity>

            <!-- Left Hand -->
            <a-entity id="leftHand" meta-touch-controls="hand: left" raycaster="objects: .clickable; showLine: true"
                line="color: #00BCD4" vr-button-click-logger>
            </a-entity>
        </a-entity>

    </a-scene>

    <script>
        // Component to log button presses and intersection hits
        AFRAME.registerComponent('vr-button-click-logger', {
            init: function () {
                const el = this.el;

                // When the controller button is pressed
                el.addEventListener('buttondown', function () {
                    const raycaster = el.components.raycaster;
                    const intersects = raycaster ? raycaster.intersections : [];

                    if (intersects.length > 0) {
                        const hitObj = intersects[0].object;
                        console.log('âœ… Controller Button HIT:', hitObj.name || hitObj.el);
                    } else {
                        console.log('âŒ Button pressed, but no intersection');
                    }
                });

                // Log what the ray is seeing
                el.addEventListener('raycaster-intersection', function (e) {
                    console.log('ðŸŽ¯ Raycaster seeing:', e.detail.els.map(el => el.id || el.tagName));
                });

                el.addEventListener('raycaster-intersection-cleared', function () {
                    console.log('âšª Raycaster cleared from:', el.id);
                });
            }
        });
    </script>
</body>

</html>